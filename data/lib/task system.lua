maxTasks = 30   --numero maximo de tasks q um player pode ter simultaniamente...  aconcelho 30~40maximo!
---
npcsTask = {   --["npc name"] = {"city do npc", "task", "reward"},
["Juvenal"] = {"Saffron", "10 Abras, 8 Kadabras and 5 Alakazams", "500 dl"}, 
["Junior"] = {"Saffron", "20 Abras, 20 Kadabras, 20 Hypnos and 25 Alakazams", "500 dl"}, 
["Blaine"] = {"Saffron", "20 Abras, 20 Kadabras, 20 Hypnos and 25 Alakazams", "500 dl"}, 
---
-- [ Orebound ] --
["Sand Trainer_1"] = {"Orebound Clan", "20 Magneton, 20 Charmeleons and 25 Gravelers", "Move up of Rank"},
["Sand Trainer_2"] = {"Orebound Clan", "20 Nidoqueen, 20 Onixs and 25 Nidokings", "Move up of Rank"},

["Rock Trainer_1"] = {"Orebound Clan", "20 Gravelers, 20 Venomoths, 25 Kadabras and 25 Electrodes", "Move up of Rank"},
["Rock Trainer_2"] = {"Orebound Clan", "20 Golems, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

["Solid Trainer_1"] = {"Orebound Clan", "20 Gravelers, 20 Venomoths, 25 Kadabras and 25 Electrodes", "Move up of Rank"},
["Solid Trainer_2"] = {"Orebound Clan", "20 Golems, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

["Hardskin Trainer_1"] = {"Orebound Clan", "20 Gravelers, 20 Venomoths, 25 Kadabras and 25 Electrodes", "Move up of Rank"},
["Hardskin Trainer_2"] = {"Orebound Clan", "20 Golems, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

-- [ Gardestrike ] --
["Fist Trainer_1"] = {"Gardestrike Clan", "20 Gravelers, 20 Onixs and 25 Clefables", "Move up of Rank"},
["Fist Trainer_2"] = {"Gardestrike Clan", "20 Golems, 20 Jynxs and 25 Kangaskhans", "Move up of Rank"},

["Tamer Trainer_1"] = {"Gardestrike Clan", "20 Gravelers, 20 Onixs and 25 Clefables", "Move up of Rank"},
["Tamer Trainer_2"] = {"Gardestrike Clan", "20 Golems, 20 Jynxs and 25 Kangaskhans", "Move up of Rank"},

["Fighter Trainer_1"] = {"Gardestrike Clan", "20 Gravelers, 20 Onixs and 25 Clefables", "Move up of Rank"},
["Fighter Trainer_2"] = {"Gardestrike Clan", "20 Golems, 20 Jynxs and 25 Kangaskhans", "Move up of Rank"},

["DeathHand Trainer_1"] = {"Gardestrike Clan", "20 Gravelers, 20 Onixs and 25 Clefables", "Move up of Rank"},
["DeathHand Trainer_2"] = {"Gardestrike Clan", "20 Golems, 20 Jynxs and 25 Kangaskhans", "Move up of Rank"},

-- [ Malefic ] --
["Troublemaker Trainer_1"] = {"Malefic Clan", "20 Haunters, 20 Kadabras and 25 Drowzees", "Move up of Rank"},
["Troublemaker Trainer_2"] = {"Malefic Clan", "20 Gengar, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

["Venomancer Trainer_1"] = {"Malefic Clan", "20 Haunters, 20 Kadabras and 25 Drowzees", "Move up of Rank"},
["Venomancer Trainer_2"] = {"Malefic Clan", "20 Gengar, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

["Spectre Trainer_1"] = {"Malefic Clan", "20 Haunters, 20 Kadabras and 25 Drowzees", "Move up of Rank"},
["Spectre Trainer_2"] = {"Malefic Clan", "20 Gengar, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

["Nightwalker Trainer_1"] = {"Malefic Clan", "20 Haunters, 20 Kadabras and 25 Drowzees", "Move up of Rank"},
["Nightwalker Trainer_2"] = {"Malefic Clan", "20 Gengar, 20 Alakazams and 25 Nidokings", "Move up of Rank"},

-- [ Naturia ] --
["Seed Trainer_1"] = {"Naturia Clan", "20 Gravelers, 20 Starmies and 25 Onixs", "Move up of Rank"},
["Seed Trainer_2"] = {"Naturia Clan", "20 Marowaks, 20 Blastoises and 25 Golems", "Move up of Rank"},

["Sprout Trainer_1"] = {"Naturia Clan", "20 Gravelers, 20 Starmies and 25 Onixs", "Move up of Rank"},
["Sprout Trainer_2"] = {"Naturia Clan", "20 Marowaks, 20 Blastoises and 25 Golems", "Move up of Rank"},

["Webhead Trainer_1"] = {"Naturia Clan", "20 Gravelers, 20 Starmies and 25 Onixs", "Move up of Rank"},
["Webhead Trainer_2"] = {"Naturia Clan", "20 Marowaks, 20 Blastoises and 25 Golems", "Move up of Rank"},

["Woodtrunk Trainer_1"] = {"Naturia Clan", "20 Gravelers, 20 Starmies and 25 Onixs", "Move up of Rank"},
["Woodtrunk Trainer_2"] = {"Naturia Clan", "20 Marowaks, 20 Blastoises and 25 Golems", "Move up of Rank"},

-- [ Psycraft ] --
["Mind Trainer_1"] = {"Psycraft Clan", "20 Primeapes, 20 Machokes and 25 Arboks", "Move up of Rank"},
["Mind Trainer_2"] = {"Psycraft Clan", "20 Machamps, 20 Venomoths and 25 Nidokings", "Move up of Rank"},

["Brain Trainer_1"] = {"Psycraft Clan", "20 Primeapes, 20 Machokes and 25 Arboks", "Move up of Rank"},
["Brain Trainer_2"] = {"Psycraft Clan", "20 Machamps, 20 Venomoths and 25 Nidokings", "Move up of Rank"},

["Scholar Trainer_1"] = {"Psycraft Clan", "20 Primeapes, 20 Machokes and 25 Arboks", "Move up of Rank"},
["Scholar Trainer_2"] = {"Psycraft Clan", "20 Machamps, 20 Venomoths and 25 Nidokings", "Move up of Rank"},

["Telepath Trainer_1"] = {"Psycraft Clan", "20 Primeapes, 20 Machokes and 25 Arboks", "Move up of Rank"},
["Telepath Trainer_2"] = {"Psycraft Clan", "20 Machamps, 20 Venomoths and 25 Nidokings", "Move up of Rank"},

-- [ Raibolt ] --
["Shock Trainer_1"] = {"Raibolt Clan", "20 Wartortles, 20 Starmies and 25 Kinglers", "Move up of Rank"},
["Shock Trainer_2"] = {"Raibolt Clan", "20 Pidgeots, 20 Blastoises and 25 Fearows", "Move up of Rank"},

["Watt Trainer_1"] = {"Raibolt Clan", "20 Wartortles, 20 Starmies and 25 Kinglers", "Move up of Rank"},
["Watt Trainer_2"] = {"Raibolt Clan", "20 Pidgeots, 20 Blastoises and 25 Fearows", "Move up of Rank"},

["Electrician Trainer_1"] = {"Raibolt Clan", "20 Wartortles, 20 Starmies and 25 Kinglers", "Move up of Rank"},
["Electrician Trainer_2"] = {"Raibolt Clan", "20 Pidgeots, 20 Blastoises and 25 Fearows", "Move up of Rank"},

["Overcharged Trainer_1"] = {"Raibolt Clan", "20 Wartortles, 20 Starmies and 25 Kinglers", "Move up of Rank"},
["Overcharged Trainer_2"] = {"Raibolt Clan", "20 Pidgeots, 20 Blastoises and 25 Fearows", "Move up of Rank"},

-- [ Seavell ] --
["Drop Trainer_1"] = {"Seavell Clan", "20 Pidgeots, 20 Sandslashs and 25 Dratinis", "Move up of Rank"},
["Drop Trainer_2"] = {"Seavell Clan", "20 Venusaurs, 20 Exeggutors and 25 Dragonairs", "Move up of Rank"},

["Icelake Trainer_1"] = {"Seavell Clan", "20 Pidgeots, 20 Sandslashs and 25 Dratinis", "Move up of Rank"},
["Icelake Trainer_2"] = {"Seavell Clan", "20 Venusaurs, 20 Exeggutors and 25 Dragonairs", "Move up of Rank"},

["Waterfall Trainer_1"] = {"Seavell Clan", "20 Pidgeots, 20 Sandslashs and 25 Dratinis", "Move up of Rank"},
["Waterfall Trainer_2"] = {"Seavell Clan", "20 Venusaurs, 20 Exeggutors and 25 Dragonairs", "Move up of Rank"},

["Frost Trainer_1"] = {"Seavell Clan", "20 Pidgeots, 20 Sandslashs and 25 Dratinis", "Move up of Rank"},
["Frost Trainer_2"] = {"Seavell Clan", "20 Venusaurs, 20 Exeggutors and 25 Dragonairs", "Move up of Rank"},

-- [ Volcanic ] --
["Spark Trainer_1"] = {"Volcanic Clan", "20 Ivysaurs, 20 Butterfrees and 25 Tangelas", "Move up of Rank"},
["Spark Trainer_2"] = {"Volcanic Clan", "20 Jynxs, 20 Venusaurs and 25 Pinsirs", "Move up of Rank"},

["Flame Trainer_1"] = {"Volcanic Clan", "20 Ivysaurs, 20 Butterfrees and 25 Tangelas", "Move up of Rank"},
["Flame Trainer_2"] = {"Volcanic Clan", "20 Jynxs, 20 Venusaurs and 25 Pinsirs", "Move up of Rank"},

["Firetamer Trainer_1"] = {"Volcanic Clan", "20 Ivysaurs, 20 Butterfrees and 25 Tangelas", "Move up of Rank"},
["Firetamer Trainer_2"] = {"Volcanic Clan", "20 Jynxs, 20 Venusaurs and 25 Pinsirs", "Move up of Rank"},

["Pyromancer Trainer_1"] = {"Volcanic Clan", "20 Ivysaurs, 20 Butterfrees and 25 Tangelas", "Move up of Rank"},
["Pyromancer Trainer_2"] = {"Volcanic Clan", "20 Jynxs, 20 Venusaurs and 25 Pinsirs", "Move up of Rank"},

-- [ Wingeon ] --
["Cloud Trainer_1"] = {"Wingeon Clan", "20 Ivysaurs, 20 Tangelas and 25 Parasects", "Move up of Rank"},
["Cloud Trainer_2"] = {"Wingeon Clan", "20 Pinsirs, 20 Venusaurs and 25 Farfetch'ds", "Move up of Rank"},

["Wind Trainer_1"] = {"Wingeon Clan", "20 Ivysaurs, 20 Tangelas and 25 Parasects", "Move up of Rank"},
["Wind Trainer_2"] = {"Wingeon Clan", "20 Pinsirs, 20 Venusaurs and 25 Farfetch'ds", "Move up of Rank"},

["Sky Trainer_1"] = {"Wingeon Clan", "20 Ivysaurs, 20 Tangelas and 25 Parasects", "Move up of Rank"},
["Sky Trainer_2"] = {"Wingeon Clan", "20 Pinsirs, 20 Venusaurs and 25 Farfetch'ds", "Move up of Rank"},

["Falcon Trainer_1"] = {"Wingeon Clan", "20 Ivysaurs, 20 Tangelas and 25 Parasects", "Move up of Rank"},
["Falcon Trainer_2"] = {"Wingeon Clan", "20 Pinsirs, 20 Venusaurs and 25 Farfetch'ds", "Move up of Rank"},

-- [ end ] --

}


function getStingOfTask(cid, npc)
if not isCreature(cid) then return "" end
local str = {}
local c = 0
local nome = (npc and type(npc) == "string") and npc or (npc and isCreature(npc)) and getCreatureName(npc) or "" 
for i = 91001, (91000+maxTasks) do
    if getPlayerStorageValue(cid, i) ~= -1 and tostring(getPlayerStorageValue(cid, i)) then
       local array = getArrayFromStorage(cid, i)
       if arrayHasContent(array) then
          for e, f in pairs(array) do
              if (not npc) or (nome ~= "" and e == nome) then
                 for a = 1, #f do 
                     local poke = f[a][1]
                     local num = f[a][2]
                     if tonumber(num) >= 1 then
                        table.insert(str, ((a ~= 1 and c ~= 0) and ", " or "")..num.." "..poke..(num == 1 and "" or "s"))
                        c = c+1
                     end 
                 end
                 table.insert(str, ".\n")
              end
          end
       end
    end
end
return table.concat(str)
end

function arrayHasContent(array)
if type(array) ~= "table" then return false end
return next(array) and true or false
end

function getMyTaskSto(cid, npc)
if not isCreature(cid) or (type(npc) ~= "string" and not isCreature(npc)) then return -1 end
for i = 91001, (91000+maxTasks) do
    if getPlayerStorageValue(cid, i) ~= -1 and tostring(getPlayerStorageValue(cid, i)) then
       local t = string.explode(getPlayerStorageValue(cid, i), "/")
       if tostring(t[1]) and tostring(t[1]) == (type(npc) == "string" and npc or getCreatureName(npc)) then
          return i
       end
    end
end
return -1
end

function isMyTaskComplete(cid, npc)
if not isCreature(cid) or (type(npc) ~= "string" and not isCreature(npc)) then return false end
local storage = getMyTaskSto(cid, npc)
local count = 0
   if storage ~= -1 then
      local array = getArrayFromStorage(cid, storage)
      for e, f in pairs(array) do
          for i = 1, #f do
              count = count+f[i][2]
          end
      end
   else
      return false
   end
if count == 0 then return true end
end
 
function getFreeTaskStorage(cid)
if not isCreature(cid) then return -1 end
for i = 91001, (91000+maxTasks) do
    if type(getPlayerStorageValue(cid, i)) == "number" and getPlayerStorageValue(cid, i) <= -1 then
       return i
    end
end
return -1
end

function setStorageArray(cid, storage, array)
if not isCreature(cid) or not storage or type(array) ~= "table" then return false end
local str = ""
for e, f in pairs(array) do
    for i = 1, #f do 
        str = i == 1 and str..""..e.." / " or str..""
        str = i == 1 and str..""..f[i][1] or str..";"..f[i][1]
        str = str..", "..f[i][2] 
    end
end
setPlayerStorageValue(cid, storage, str)
return true
end

function getArrayFromStorage(cid, storage)
if not isCreature(cid) or not storage or type(getPlayerStorageValue(cid, storage)) ~= "string" then return {} end
local array = {}
local name = string.explode(getPlayerStorageValue(cid, storage), "/")
if not name or type(name) ~= "table" then return {} end
local t1 = string.explode(name[2], ";")
array[name[1]] = {}
for i = 1, #t1 do
    local t2 = string.explode(t1[i], ",")
    table.insert(array[name[1]], {t2[1], t2[2]})
end
return array
end